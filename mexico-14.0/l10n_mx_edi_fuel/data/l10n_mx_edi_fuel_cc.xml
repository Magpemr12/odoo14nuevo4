<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="l10n_mx_edi_fuel_cc">
        <cfdi:Complemento xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <t t-if="record.move_type != 'out_refund' and record.l10n_mx_edi_emitter_reference">
                <t t-set="ref_data" t-value="record.l10n_mx_edi_emitter_reference.split('|')"/>
                <t t-set="identificador" t-value="ref_data[0].strip() if ref_data else ''" />
                <t t-set="numeroCuenta" t-value="ref_data[1].strip() if len(ref_data) >= 2 else ''"/>
            </t>
            <consumodecombustibles11:ConsumoDeCombustibles
                xsi:schemaLocation="http://www.sat.gob.mx/ConsumoDeCombustibles11 http://www.sat.gob.mx/sitio_internet/cfd/ConsumoDeCombustibles/consumodeCombustibles11.xsd"
                xmlns:consumodecombustibles11="http://www.sat.gob.mx/ConsumoDeCombustibles11"
                version="1.1"
                tipoOperacion="monedero electrÃ³nico"
                t-att-numeroDeCuenta="record.partner_bank_id.acc_number if record.move_type == 'out_refund' else numeroCuenta or ''"
                t-att-subTotal="fuel_amount_untaxed"
                t-att-total="fuel_amount_total">
                <consumodecombustibles11:Conceptos>
                    <t t-foreach="fuel_lines" t-as="line">
                        <consumodecombustibles11:ConceptoConsumoDeCombustibles
                            t-att-identificador="record.name if record.move_type == 'out_refund' else identificador or ''"
                            t-att-fecha="cfdi_date"
                            t-att-rfc="customer_rfc if record.move_type == 'out_refund' else record.company_id.vat"
                            t-att-claveEstacion="record.partner_id.ref if record.move_type == 'out_refund' else supplier.ref"
                            t-att-tipoCombustible="line.product_id.default_code"
                            t-att-cantidad="format_float(line.quantity, 3)"
                            t-att-nombreCombustible="(line.name or '')[:1000]"
                            t-att-folioOperacion="record.l10n_mx_edi_origin.split('|')[1] if record.l10n_mx_edi_origin and len(record.l10n_mx_edi_origin.split('|')) &gt; 1 else None"
                            t-att-valorUnitario="format_float(line.price_unit, currency_precision)"
                            t-att-importe="format_float(record.currency_id.round(line.price_unit * line.quantity), currency_precision)">
                            <t t-set="taxes_line" t-value="line.tax_ids"/>
                            <t t-if="taxes_line">
                                <t t-set="transferred" t-value="taxes_line.filtered(lambda r: r.amount &gt;= 0)"/>
                                <t t-if="transferred">
                                    <consumodecombustibles11:Determinados>
                                       <t t-foreach="transferred" t-as="tax">
                                           <consumodecombustibles11:Determinado
                                                t-att-Impuesto="tax.mapped('invoice_repartition_line_ids.tag_ids').name if tax.mapped('invoice_repartition_line_ids.tag_ids') else ''"
                                                t-att-tasaOCuota="format_float(abs(tax.amount / 100.0), 6) if tax.l10n_mx_tax_type != 'Exento' else False"
                                                t-att-importe="format_float(abs(tax.amount / 100.0 * line.price_subtotal), 2) if tax.l10n_mx_tax_type != 'Exento' else False"/>
                                        </t>
                                    </consumodecombustibles11:Determinados>
                                </t>
                            </t>
                        </consumodecombustibles11:ConceptoConsumoDeCombustibles>
                    </t>
                </consumodecombustibles11:Conceptos>
            </consumodecombustibles11:ConsumoDeCombustibles>
        </cfdi:Complemento>
    </template>
</odoo>
